<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flappy Bird with Score Upload</title>

    <!-- Bootstrap for Navbar -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
        }

        #board {
            display: block;
            margin: auto;
            background-image: url("./flappybirdbg.png");
        }

        #userInputOverlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex; justify-content: center; align-items: center;
            color: white;
            z-index: 10;
        }

        #userInputOverlay input, #userInputOverlay textarea {
            display: block; margin: 10px 0; width: 300px; font-size: 18px; padding: 8px;
            border-radius: 5px; border: none;
        }

        #userInputOverlay button {
            font-size: 18px; padding: 8px 16px; border-radius: 5px; border: none; cursor: pointer;
            background: #28a745; color: white;
        }

        .navbar {
            background-color: #111 !important;
        }

        .navbar-brand, .nav-link {
            color: #0ff !important;
            font-weight: bold;
            font-family: monospace;
            text-shadow: 0 0 6px #0ff;
        }
    </style>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700" />
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">üè≥Ô∏è‚Äçüåà Adheesh Gay Arcade</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="#">Scoreboard</a></li>
                <li class="nav-item"><a class="nav-link" href="#">About</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- Input Overlay -->
<div id="userInputOverlay">
    <div>
        <h2>Enter your name and comment</h2>
        <input id="username" type="text" placeholder="Your name" />
        <textarea id="usercomment" rows="3" placeholder="Your comment for Adheesh"></textarea>
        <button id="startBtn">Start Game</button>
    </div>
</div>

<canvas id="board"></canvas>

<script>
    let userName = null;
    let userComment = null;

    document.getElementById("startBtn").onclick = () => {
        const nameInput = document.getElementById("username").value.trim();
        const commentInput = document.getElementById("usercomment").value.trim();

        if(!nameInput) {
            alert("Please enter your name.");
            return;
        }

        userName = nameInput;
        userComment = commentInput;

        document.getElementById("userInputOverlay").style.display = "none";
        startGame();
    };

    let board, context;
    let boardWidth = 360;
    let boardHeight = 640;

    let birdWidth = 34 * 1.4;
    let birdHeight = 24 * 1.4;
    let birdX = boardWidth / 6;
    let birdY = boardHeight / 1.5;
    let birdImg, topPipeImg, bottomPipeImg;

    let bird = { x: birdX, y: birdY, width: birdWidth, height: birdHeight };
    let pipeArray = [];
    let pipeWidth = 64, pipeHeight = 512, pipeX = boardWidth, pipeY = 0;

    let velocityX = -1.5;
    let velocityY = 0;
    let gravity = 0.25;

    let gameOver = false;
    let score = 0;

    function startGame() {
        board = document.getElementById("board");
        board.width = boardWidth;
        board.height = boardHeight;
        context = board.getContext("2d");

        birdImg = new Image();
        birdImg.src = "./flappybird.png";

        topPipeImg = new Image();
        topPipeImg.src = "./toppipe.png";

        bottomPipeImg = new Image();
        bottomPipeImg.src = "./bottompipe.png";

        bird.y = birdY;
        velocityY = 0;
        pipeArray = [];
        score = 0;
        gameOver = false;

        document.addEventListener("keydown", moveBird);
        document.addEventListener("mousedown", moveBird);
        document.addEventListener("touchstart", moveBird);

        requestAnimationFrame(update);
        setInterval(placePipes, 2000); // Slower pipe frequency
    }

    function update() {
        requestAnimationFrame(update);
        if (gameOver) return;

        context.clearRect(0, 0, board.width, board.height);

        velocityY += gravity;
        bird.y = Math.max(bird.y + velocityY, 0);
        context.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);

        if (bird.y > board.height) return endGame();

        for (let pipe of pipeArray) {
            pipe.x += velocityX;
            context.drawImage(pipe.img, pipe.x, pipe.y, pipe.width, pipe.height);

            if (!pipe.passed && bird.x > pipe.x + pipe.width) {
                score += 0.5;
                pipe.passed = true;
            }

            if (detectCollision(bird, pipe)) return endGame();
        }

        while (pipeArray.length > 0 && pipeArray[0].x < -pipeWidth) {
            pipeArray.shift();
        }

        context.fillStyle = "white";
        context.font = "45px sans-serif";
        context.fillText(Math.floor(score), 5, 45);
    }

    function placePipes() {
        if (gameOver) return;

        let randomPipeY = pipeY - pipeHeight / 4 - Math.random() * (pipeHeight / 1.5);
        let openingSpace = board.height / 3.5;

        pipeArray.push({
            img: topPipeImg,
            x: pipeX,
            y: randomPipeY,
            width: pipeWidth,
            height: pipeHeight,
            passed: false,
        });

        pipeArray.push({
            img: bottomPipeImg,
            x: pipeX,
            y: randomPipeY + pipeHeight + openingSpace,
            width: pipeWidth,
            height: pipeHeight,
            passed: false,
        });
    }

    function moveBird(e) {
        if (
            e.code === "Space" ||
            e.code === "ArrowUp" ||
            e.code === "KeyX" ||
            e.type === "mousedown" ||
            e.type === "touchstart"
        ) {
            velocityY = -5;

            if (gameOver) {
                bird.y = birdY;
                pipeArray = [];
                score = 0;
                gameOver = false;
            }
        }
    }

    function detectCollision(a, b) {
        return (
            a.x < b.x + b.width &&
            a.x + a.width > b.x &&
            a.y < b.y + b.height &&
            a.y + a.height > b.y
        );
    }

    function endGame() {
        gameOver = true;

        context.fillStyle = "white";
        context.font = "45px sans-serif";
        context.fillText("GAME OVER", 5, 90);

        postScore(userName, userComment, Math.floor(score));
    }

    function postScore(name, comment, score) {
        const url = "https://v1.nocodeapi.com/justarpaan/google_sheets/FSLilTVNFEYqlrpo?tabId=Sheet1";
        const bodyData = JSON.stringify([[name, comment, score]]);

        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: bodyData,
        })
        .then((response) => response.text())
        .then((result) => console.log("Score posted:", result))
        .catch((error) => console.error("Error posting score:", error));
    }
</script>

</body>
</html>
